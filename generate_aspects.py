#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –º–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–∏—Å–∞–Ω–∏–π –¥–ª—è –∞—Å–ø–µ–∫—Ç–æ–≤"""

import json

# –®–∞–±–ª–æ–Ω—ã –¥–ª—è –∞—Å–ø–µ–∫—Ç–æ–≤ –º–µ–∂–¥—É –ø–ª–∞–Ω–µ—Ç–∞–º–∏
ASPECT_TEMPLATES = {
    'Conjunction': {
        'desc': '–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ ‚Äî —Å–ª–∏—è–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–π, –µ–¥–∏–Ω—Å—Ç–≤–æ, —Å–æ–≤–º–µ—Å—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ.',
        'positive': '–≠–Ω–µ—Ä–≥–∏–∏ –ø–ª–∞–Ω–µ—Ç —É—Å–∏–ª–∏–≤–∞—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞, —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ –æ–¥–Ω–æ —Ü–µ–ª–æ–µ. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≥–ª—É–±–æ–∫–æ –ø—Ä–æ—è–≤–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–∞ –æ–±–µ–∏—Ö –ø–ª–∞–Ω–µ—Ç.',
        'negative': '–≠–Ω–µ—Ä–≥–∏–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —á—Ä–µ–∑–º–µ—Ä–Ω—ã–º–∏, –Ω–µ—É–ø—Ä–∞–≤–ª—è–µ–º—ã–º–∏. –ù—É–∂–Ω–æ –Ω–∞—É—á–∏—Ç—å—Å—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞—Ç—å –∏—Ö.',
    },
    'Sextile': {
        'desc': '–°–µ–∫—Å—Ç–∏–ª—å (60¬∞) ‚Äî –ª—ë–≥–∫–æ–µ, –≥–∞—Ä–º–æ–Ω–∏—á–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ, —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ.',
        'positive': '–≠–Ω–µ—Ä–≥–∏–∏ —Ç–µ–∫—É—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ, –ø–æ–º–æ–≥–∞—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥—É. –≠—Ç–æ –¥–∞—Ä, –∫–æ—Ç–æ—Ä—ã–π –ª–µ–≥–∫–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.',
        'negative': '–ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Å–∞–º–æ—É—Å–ø–æ–∫–æ–µ–Ω–∏—é. –ù—É–∂–Ω–æ –Ω–µ –∑–∞–±—ã–≤–∞—Ç—å —Ä–∞–∑–≤–∏–≤–∞—Ç—å —ç—Ç–∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏.',
    },
    'Square': {
        'desc': '–ö–≤–∞–¥—Ä–∞—Ç (90¬∞) ‚Äî –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ, –≤—ã–∑–æ–≤, –∫–æ–Ω—Ñ–ª–∏–∫—Ç –º–µ–∂–¥—É —ç–Ω–µ—Ä–≥–∏—è–º–∏.',
        'positive': '–≠—Ç–æ –º–æ—Ç–æ—Ä–Ω–æ–µ –º–∞—Å–ª–æ —ç–≤–æ–ª—é—Ü–∏–∏. –ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç —Ä–∞—Å—Ç–∏, –ø—Ä–µ–æ–¥–æ–ª–µ–≤–∞—Ç—å, —Ä–∞–∑–≤–∏–≤–∞—Ç—å—Å—è.',
        'negative': '–ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Ñ—Ä—É—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º. –ù—É–∂–Ω–æ –Ω–∞—É—á–∏—Ç—å—Å—è —Ç–≤–æ—Ä—á–µ—Å–∫–∏ —Ä–∞–∑—Ä–µ—à–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã.',
    },
    'Trine': {
        'desc': '–¢—Ä–∏–≥–æ–Ω (120¬∞) ‚Äî –≥–∞—Ä–º–æ–Ω–∏—è, –ø–æ–¥–¥–µ—Ä–∂–∫–∞, –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–∞–ª–∞–Ω—Ç.',
        'positive': '–≠—Ç–∏ –ø–ª–∞–Ω–µ—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –≤ —Ä–∏—Ç–º–µ. –≠—Ç–æ –≤—Ä–æ–∂–¥—ë–Ω–Ω—ã–π —Ç–∞–ª–∞–Ω—Ç, –ª—ë–≥–∫–æ–µ –ø—Ä–æ—è–≤–ª–µ–Ω–∏–µ.',
        'negative': '–ú–æ–∂–µ—Ç –±—ã—Ç—å —Å–∞–º–æ—É—Å–ø–æ–∫–æ–µ–Ω–∏–µ–º. –ù—É–∂–Ω–æ –∞–∫—Ç–∏–≤–Ω–æ —Ä–∞–∑–≤–∏–≤–∞—Ç—å –¥–∞—Ä—ã, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ –∏—Ö –∏–º–µ—Ç—å.',
    },
    'Opposition': {
        'desc': '–û–ø–ø–æ–∑–∏—Ü–∏—è (180¬∞) ‚Äî –ø—Ä–æ—Ç–∏–≤–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ, –ø–æ–ª—è—Ä–Ω–æ—Å—Ç—å, –ø–æ–∏—Å–∫ –±–∞–ª–∞–Ω—Å–∞.',
        'positive': '–î–≤–µ —Å—Ç–æ—Ä–æ–Ω—ã –º–µ–¥–∞–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –≤–º–µ—Å—Ç–µ. –≠—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–æ—Å—Ç–µ–π.',
        'negative': '–ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞–º –∏ –ø—Ä–æ–µ–∫—Ü–∏—è–º –Ω–∞ –¥—Ä—É–≥–∏—Ö. –ù—É–∂–Ω–æ –ø—Ä–∏–Ω—è—Ç—å –æ–±–µ —Å—Ç–æ—Ä–æ–Ω—ã.',
    },
    'Quincunx': {
        'desc': '–ö–≤–∏–Ω–∫–æ–Ω—Å (150¬∞) ‚Äî –ø—Ä–µ–¥—á—É–≤—Å—Ç–≤–∏–µ, —Ä–µ–≤–∏–∑–∏—è, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –ø—Ä–∏—Å–ø–æ—Å–∞–±–ª–∏–≤–∞—Ç—å—Å—è.',
        'positive': '–≠—Ç–æ –ø–æ–¥—Å–∫–∞–∑–∫–∞, —á—Ç–æ –Ω—É–∂–Ω–æ —á—Ç–æ-—Ç–æ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞—Ç—å. –†–∞–∑–≤–∏–≤–∞–µ—Ç –≥–∏–±–∫–æ—Å—Ç—å –∏ –ø—Ä–æ–Ω–∏—Ü–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å.',
        'negative': '–ú–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –±–µ—Å–ø–æ–∫–æ–π—Å—Ç–≤–∞ –∏ –Ω–µ—É–¥–æ–±—Å—Ç–≤–∞. –¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.',
    },
}

# –ù–∞–∑–≤–∞–Ω–∏—è –ø–ª–∞–Ω–µ—Ç –¥–ª—è –∞—Å–ø–µ–∫—Ç–æ–≤
PLANETS_SHORT = {
    'Sun': '–°–æ–ª–Ω—Ü–∞', 'Moon': '–õ—É–Ω—ã', 'Mercury': '–ú–µ—Ä–∫—É—Ä–∏—è', 'Venus': '–í–µ–Ω–µ—Ä—ã',
    'Mars': '–ú–∞—Ä—Å–∞', 'Jupiter': '–Æ–ø–∏—Ç–µ—Ä–∞', 'Saturn': '–°–∞—Ç—É—Ä–Ω–∞', 'Uranus': '–£—Ä–∞–Ω–∞',
    'Neptune': '–ù–µ–ø—Ç—É–Ω–∞', 'Pluto': '–ü–ª—É—Ç–æ–Ω–∞', 'Lilith': '–õ–∏–ª–∏—Ç',
    'North_node': '–°–µ–≤. —É–∑–ª–∞', 'South_node': '–Æ–∂. —É–∑–ª–∞',
    'ASC': '–ê—Å—Ü–µ–Ω–¥–µ–Ω—Ç–∞', 'MC': '–°–µ—Ä–µ–¥–∏–Ω—ã –ù–µ–±–∞'
}

def generate_aspect_text(p1_key, p2_key, aspect_type):
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç –¥–ª—è –∞—Å–ø–µ–∫—Ç–∞ –º–µ–∂–¥—É –¥–≤—É–º—è –ø–ª–∞–Ω–µ—Ç–∞–º–∏"""
    
    p1_name = PLANETS_SHORT.get(p1_key, p1_key)
    p2_name = PLANETS_SHORT.get(p2_key, p2_key)
    
    template = ASPECT_TEMPLATES.get(aspect_type, {})
    if not template:
        return f"{aspect_type} –º–µ–∂–¥—É {p1_name} –∏ {p2_name} ‚Äî –º–∏—Å—Ç–∏—á–µ—Å–∫–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ—Å–º–∏—á–µ—Å–∫–∏—Ö —ç–Ω–µ—Ä–≥–∏–π."
    
    text = f"{template['desc']} {p1_name} –∏ {p2_name} –≤—Å—Ç—É–ø–∞—é—Ç –≤ –¥–∏–∞–ª–æ–≥.\n\n"
    text += f"‚ú® –î–∞—Ä: {template['positive']}\n\n"
    text += f"‚ö†Ô∏è –í—ã–∑–æ–≤: {template['negative']}\n\n"
    text += f"üîÆ –°–æ–≤–µ—Ç: –°–ª—É—à–∞–π—Ç–µ, –∫–∞–∫ —ç—Ç–∏ –¥–≤–µ –ø–ª–∞–Ω–µ—Ç—ã –≥–æ–≤–æ—Ä—è—Ç —á–µ—Ä–µ–∑ –≤–∞—Å. –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ –∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –µ–¥–∏–Ω–æ–µ —Ü–µ–ª–æ–µ. –≠—Ç–æ –ø—É—Ç—å –æ—Ç —Ä–∞–∑–¥–≤–æ–µ–Ω–Ω–æ—Å—Ç–∏ –∫ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏."
    
    return text

def main():
    # –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π JSON
    with open('/opt/natal_chart/texts.json', 'r', encoding='utf-8') as f:
        data = json.load(f)
    
    print("üåÄ –ì–µ–Ω–µ—Ä–∏—Ä—É—é –º–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è –¥–ª—è –∞—Å–ø–µ–∫—Ç–æ–≤...\n")
    
    # –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º –∞—Å–ø–µ–∫—Ç–∞–º –≤ JSON
    if 'aspects' not in data:
        data['aspects'] = {}
    
    aspect_count = 0
    
    for aspect_type, pairs_dict in data['aspects'].items():
        if not isinstance(pairs_dict, dict):
            continue
        
        for pair_key, pair_data in list(pairs_dict.items()):
            if isinstance(pair_data, dict) and 'p1' in pair_data and 'p2' in pair_data:
                p1_key = pair_data.get('p1_key', pair_data['p1'].split()[0] if ' ' in pair_data['p1'] else pair_data['p1'])
                p2_key = pair_data.get('p2_key', pair_data['p2'].split()[0] if ' ' in pair_data['p2'] else pair_data['p2'])
                
                # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç
                text = generate_aspect_text(p1_key, p2_key, aspect_type)
                data['aspects'][aspect_type][pair_key]['text'] = text
                
                aspect_count += 1
                if aspect_count % 100 == 0:
                    print(f"‚úì –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ {aspect_count} –∞—Å–ø–µ–∫—Ç–æ–≤")
    
    print(f"\n‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–æ–≤ –∞—Å–ø–µ–∫—Ç–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–∞: {aspect_count} –∞—Å–ø–µ–∫—Ç–æ–≤")
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π JSON
    with open('/opt/natal_chart/texts.json', 'w', encoding='utf-8') as f:
        json.dump(data, f, ensure_ascii=False, indent=2)
    
    print("üíæ –§–∞–π–ª texts.json –æ–±–Ω–æ–≤–ª—ë–Ω —Å –æ–ø–∏—Å–∞–Ω–∏—è–º–∏ –∞—Å–ø–µ–∫—Ç–æ–≤!")

if __name__ == '__main__':
    main()
